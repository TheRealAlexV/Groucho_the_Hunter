# =============================================================================
# Docker Compose - DEVELOPMENT Configuration
# =============================================================================
# Optimized for developer experience with hot reload and fast iteration
# Uses Vite dev server (port 3000) with live code reloading
# =============================================================================

version: '3.8'

services:
  # ---------------------------------------------------------------------------
  # Development Server with Hot Reload
  # ---------------------------------------------------------------------------
  groucho-dev:
    build:
      context: .
      dockerfile: Dockerfile
      target: builder  # Use only the build stage (Node.js)
    
    # Container name
    container_name: groucho-the-hunter-dev
    
    # Port mapping - Vite dev server runs on port 3000
    ports:
      - "3000:3000"
      # HMR websocket port for faster updates
      - "24678:24678"
    
    # Volume mounts for live code editing
    volumes:
      # Mount source code for hot reload (read-write for HMR)
      - ./src:/app/src
      - ./public:/app/public
      - ./index.html:/app/index.html
      - ./vite.config.js:/app/vite.config.js
      - ./package.json:/app/package.json
      # Named volume for node_modules (isolated from host)
      - node_modules:/app/node_modules
    
    # Working directory
    working_dir: /app
    
    # Environment variables for development
    environment:
      - NODE_ENV=development
      - CHOKIDAR_USEPOLLING=true  # Enable polling for file watching in Docker
      - VITE_HMR_PORT=24678
      - VITE_HMR_HOST=0.0.0.0
    
    # Start Vite dev server with host binding for external access
    command: npm run dev -- --host 0.0.0.0 --port 3000
    
    # Keep stdin open for interactive debugging
    stdin_open: true
    tty: true
    
    # Restart policy for development convenience
    restart: unless-stopped

# ---------------------------------------------------------------------------
# Named Volumes
# ---------------------------------------------------------------------------
volumes:
  node_modules:
    driver: local

# =============================================================================
# USAGE COMMANDS
# =============================================================================
#
# Start development server:
#   docker-compose up
#   docker-compose up -d    (detached mode)
#
# View logs:
#   docker-compose logs -f groucho-dev
#
# Restart after dependency changes:
#   docker-compose down
#   docker-compose up --build
#
# Shell into container:
#   docker-compose exec groucho-dev sh
#
# Install new dependencies:
#   docker-compose exec groucho-dev npm install <package>
#
# For production deployment, use:
#   docker-compose -f docker-compose.prod.yml up -d
#
# =============================================================================
